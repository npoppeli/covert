<!--! data -->
<form class="form-horizontal" action="${this['buttons'][0]['action']}" method="POST"
      tal:define="item this['data']; meta this['meta']; fields item.keys()">
  <fieldset>
    <input tal:condition="this['method']" type="hidden" name="_method" value="${this['method']}"/>
    <span tal:repeat="key [key for key in fields if meta[key]['formtype'] == 'hidden']" tal:omit-tag="">
      <input type="hidden" name="${key}" value="${item[key]}"/>
    </span>
    <div tal:repeat="key [key for key in fields if meta[key]['formtype'] != 'hidden']">
      <label tal:define="label meta[key]['label']"
             for="${key}" class="col-sm-3 control-label">${label}</label>
        <div class="col-sm-7"
             tal:define="value item[key]; control meta[key]['control']" tal:switch="control">
          <div class="form-control" tal:case="'radio'">
            <span tal:repeat="option meta[key]['enum']" tal:omit-tag="">
              <label tal:define="subkey key+'_'+str(repeat.option.index)" class="radio-inline" for="${subkey}">
                <input type="radio" name="${key}" id="${subkey}"
                       tal:attributes="checked 'checked' if item[key]==option  else default"
                       value="${repeat.option.index}"/>${option}</label>
            </span>
          </div>
          <span tal:case="'input'" tal:omit-tag="">
            <input class="form-control" type="${meta[key]['formtype']}" name="${key}" id="${key}" value="${value}"/>
          </span>
          <span tal:case="'textarea'" tal:omit-tag="">
            <textarea class="form-control" rows="4" cols="50" name="${key}" id="${key}">${value}</textarea>
          </span>
        </div>
      </div>
  </fieldset>
<!--! buttons -->
  <div>
    <button tal:repeat="button this['buttons']" class="btn btn-primary btn-sm"
            type="submit" name="_submit" value="${button['name']}">
      <span class="${button['icon']}"></span>${button['label']}</button>&nbsp;
  </div>
</form>
<!--! message -->
<div tal:condition="this['message']">
  <p><span tal:content="structure this['message']"></p>
</div>
